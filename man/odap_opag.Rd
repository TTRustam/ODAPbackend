% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/odap.R
\name{odap_opag}
\alias{odap_opag}
\title{ODAPâ€“OPAG Mortality and Population Redistribution Analysis}
\usage{
odap_opag(
  data_in = NULL,
  Age_fit = c(60, 70),
  AgeInt_fit = c(10, 10),
  Redistribute_from = 80,
  OAnew = 100,
  method = c("mono", "pclm", "uniform"),
  nLx = NULL,
  name = "India",
  country_code = 356,
  year = 1971,
  sex = "M"
)
}
\arguments{
\item{data_in}{A data frame or tibble of population counts with columns including \code{age}, \code{pop}, and optionally \code{name}, \code{sex}, \code{year}, and \code{country_code}.}

\item{Age_fit}{Numeric vector of two ages defining the age range for fitting redistribution (default \code{c(60, 70)}).}

\item{AgeInt_fit}{Numeric vector of two age interval widths corresponding to \code{Age_fit} (default \code{c(10, 10)}).}

\item{Redistribute_from}{Numeric scalar age threshold above which population redistribution occurs (default \code{80}).}

\item{OAnew}{Numeric scalar indicating the new open-age group upper bound (default \code{100}).}

\item{method}{Character scalar specifying the redistribution method; one of \code{"mono"}, \code{"pclm"}, or \code{"uniform"} (default \code{"mono"}).}

\item{nLx}{Optional mortality life table data frame containing columns \code{age}, \code{nLx}, and grouping columns. If \code{NULL}, mortality data is pulled from the latest installed WPP package.}

\item{name}{Character vector of country names to filter by (default \code{"India"}).}

\item{country_code}{Numeric vector of country codes to filter by (default \code{356}).}

\item{year}{Numeric vector of years to filter by (default \code{1971}).}

\item{sex}{Character scalar indicating sex to filter by, e.g., \code{"M"} or \code{"F"} (default \code{"M"}).}
}
\value{
A list with two elements:
\describe{
\item{\code{data_out}}{A named list of OPAG redistribution results by group.}
\item{\code{figures}}{A named list of \code{ggplot2} objects showing original vs. redistributed populations.}
}
}
\description{
This function prepares population data and mortality life table data (\code{nLx}) to perform age redistribution using the OPAG (Old-Age Population Age Group) method.
It supports flexible input with country name/code, sex, and year filters, and handles both user-provided and WPP standard mortality data.
The function outputs adjusted population estimates along with diagnostic plots comparing original vs. redistributed populations.
}
\details{
The function:
\itemize{
\item Standardizes and validates population input data.
\item Automatically retrieves and filters WPP mortality data (\code{nLx}) if not supplied.
\item Checks age interval consistency and aggregates mortality data if necessary.
\item Applies the OPAG redistribution method per group (e.g. country, year, sex).
\item Generates diagnostic plots comparing original and redistributed population counts.
}

The function uses internal helpers such as \code{conditional_filter()},
\code{conditional_arrange()}, and \code{create_groupid()} to standardize and align data.
}
\examples{
\dontrun{
library(dplyr)

data_in <- tibble(
  age = seq(0, 100, by = 5),
  pop = runif(21, 10000, 100000),
  name = "India",
  country_code = 356,
  sex = "M",
  year = 1971
)

res <- odap_opag(data_in, Redistribute_from = 80)

# View redistributed data
res$data_out$India

# Plot original vs redistributed population
print(res$figures$India)
}
}
\seealso{
\code{\link[DemoTools]{OPAG}}, \code{\link{link[DemoTools]{lt_single_mx}}, \code{\link{\link[DemoTools]{groupAges}}
}
